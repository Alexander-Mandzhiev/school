# 🏗️ Микросервисная платформа

Мультипродуктовая платформа для разработки различных сервисов с единой системой аутентификации, авторизации и управления клиентами.

## 📋 Описание

Платформа позволяет создавать и управлять различными экземплярами приложений (школы, системы лояльности, CRM, аналитические панели и т.д.) с единой системой управления пользователями, ролями и правами доступа.

## 🏛️ Архитектура

### Микросервисы

#### 🔐 **SSO (Single Sign-On)**
**Назначение:** Система единого входа и управления пользователями
- **База данных:** `sso`
- **Основные сущности:**
  - `users` — пользователи системы
  - `roles` — роли пользователей
  - `permissions` — права доступа
  - `user_roles` — связи пользователь-роль
  - `role_permissions` — связи роль-право

#### 👥 **Clients**
**Назначение:** Управление клиентами и их контактной информацией
- **База данных:** `clients`
- **Основные сущности:**
  - `types` — типы клиентов
  - `statuses` — статусы клиентов
  - `clients` — основная информация о клиентах
  - `addresses` — адреса клиентов
  - `contacts` — контакты клиентов

#### 🔑 **Auth**
**Назначение:** Аутентификация и управление сессиями
- **База данных:** `auth`
- **Основные сущности:**
  - `statuses` — статусы связей клиент-приложение
  - `client_apps` — связи клиентов с приложениями
  - `secrets` — OAuth2 секреты
  - `refresh_tokens` — refresh токены
  - `sessions` — сессии пользователей

#### 📱 **Apps**
**Назначение:** Каталог приложений платформы
- **База данных:** `apps`
- **Основные сущности:**
  - `apps` — экземпляры приложений (школы, CRM, системы лояльности и т.д.)

#### 📊 **Audit**
**Назначение:** Система аудита и логирования
- **База данных:** `audit`
- **Основные сущности:**
  - `actions` — справочник действий для аудита
  - `logs` — логи событий системы

## 🔄 Схема взаимодействия

```
┌─────────┐    ┌─────────┐    ┌─────────┐
│  Apps   │    │ Clients │    │   SSO   │
│         │    │         │    │         │
│ • apps  │    │ • types │    │ • users │
│         │    │ • status│    │ • roles │
│         │    │ • client│    │ • perms │
│         │    │ • addr  │    │         │
│         │    │ • cont  │    │         │
└─────────┘    └─────────┘    └─────────┘
       │              │              │
       └──────────────┼──────────────┘
                      │
                ┌─────────┐
                │  Auth   │
                │         │
                │ • status│
                │ • client│
                │ • apps  │
                │ • secret│
                │ • tokens│
                │ • sess  │
                └─────────┘
                      │
                ┌─────────┐
                │  Audit  │
                │         │
                │ • action│
                │ • logs  │
                └─────────┘
```

## 🗄️ Структура базы данных

### SSO (RBAC)
- **users** — пользователи с привязкой к клиенту
- **roles** — роли с привязкой к приложению
- **permissions** — права с привязкой к приложению
- **user_roles** — связи пользователь-роль с app_id
- **role_permissions** — связи роль-право с app_id

### Clients
- **client_types** — типы клиентов (школа, компания, партнёр)
- **client_statuses** — статусы клиентов (активен, заблокирован, на модерации)
- **clients** — основная информация о клиентах
- **addresses** — адреса клиентов (поддержка множественных адресов)
- **contacts** — контакты клиентов (поддержка множественных контактов)

### Auth
- **statuses** — статусы связей клиент-приложение
- **client_apps** — связи клиентов с приложениями
- **secrets** — OAuth2 секреты для аутентификации
- **refresh_tokens** — refresh токены с поддержкой scope
- **sessions** — сессии пользователей с полным аудитом

### Apps
- **apps** — экземпляры приложений платформы

### Audit
- **actions** — справочник действий с категоризацией и важностью
- **logs** — детальные логи всех событий системы

## 🔐 Безопасность

### Аутентификация
- OAuth2/OpenID Connect
- JWT токены
- Refresh токены с ротацией
- Управление сессиями

### Авторизация
- Role-Based Access Control (RBAC)
- Права на уровне приложений
- Гибкая система ролей и разрешений

### Аудит
- Полное логирование всех действий
- Отслеживание IP адресов и user agent
- Категоризация событий по важности

## 🚀 Возможности платформы

### Мультипродуктовость
- Поддержка множественных экземпляров приложений
- Изоляция данных между клиентами
- Гибкое управление доступом

### Масштабируемость
- Микросервисная архитектура
- Независимое развертывание сервисов
- Горизонтальное масштабирование

### Гибкость
- Легкое добавление новых приложений
- Настраиваемые роли и права
- Расширяемая система аудита

## 📁 Структура проекта

```
backend/
├── migrations/
│   ├── apps/          # Миграции приложений
│   ├── audit/         # Миграции аудита
│   ├── auth/          # Миграции аутентификации
│   ├── clients/       # Миграции клиентов
│   └── sso/           # Миграции RBAC
└── protos/            # gRPC контракты
    └── proto/
        ├── apps/
        ├── audit/
        ├── auth/
        ├── clients/
        └── sso/
```

## 🛠️ Технологии

- **База данных:** PostgreSQL
- **Миграции:** Goose
- **API:** gRPC
- **Аутентификация:** OAuth2/OpenID Connect
- **Токены:** JWT
- **Архитектура:** Микросервисы

## 📈 Планы развития

- [ ] Добавление новых типов приложений
- [ ] Расширение системы аудита
- [ ] Интеграция с внешними системами
- [ ] Улучшение производительности
- [ ] Добавление аналитики и отчётов

---

## 📞 Поддержка

Для вопросов и предложений обращайтесь к команде разработки. 